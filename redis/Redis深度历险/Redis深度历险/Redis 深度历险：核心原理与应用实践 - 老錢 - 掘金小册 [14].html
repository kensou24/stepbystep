<html>
<head>
  <title>Redis 深度历险：核心原理与应用实践 - 老錢 - 掘金小册</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307474 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="4237"/>
<h1>Redis 深度历险：核心原理与应用实践 - 老錢 - 掘金小册</h1>

<div>
<span><div style="text-size-adjust: 100%; font-size: 12px; word-break: break-word; text-rendering: optimizeLegibility; background-color: rgb(244, 245, 245);"><div style="overflow:hidden;"><div style="transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);"><div style="box-sizing:border-box;background-color:rgb(230, 231, 233);"><div style="box-shadow:rgba(0, 0, 0, 0.15) 1px 1px 8px;background-color:rgb(255, 255, 255);border-radius:2px;box-sizing:border-box;"><div style="word-break: break-word; font-size: 15px;"><h1 style="font-size: 30px; margin: 35px 0px 5px; padding-bottom: 5px;"><span style="font-size: 16px; display: inline-block; min-width: 100%; position: relative;"><span style="font-size: 30px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.5;">集群 1：李代桃僵 —— Sentinel</span></span></h1><div style="margin-bottom: 22px; margin-top: 25px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">目前我们讲的 Redis 还只是主从方案，最终一致性。读者们可思考过，如果主节点凌晨 3 点突发宕机怎么办？就坐等运维从床上爬起来，然后手工进行从主切换，再通知所有的程序把地址统统改一遍重新上线么？毫无疑问，这样的人工运维效率太低，事故发生时估计得至少 1 个小时才能缓过来。如果是一个大型公司，这样的事故足以上新闻了。</span></div><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p><div style="margin: 22px auto; text-align: center;"><div><img src="https://user-gold-cdn.xitu.io/2018/7/11/164879368601d822?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" style="font-size: 11pt; color: rgb(51, 51, 51);"></img></div><div style="text-align: center; font-size: 12px; line-height: 1.6; color: rgb(144, 144, 144); margin-top: 2px;"></div></div><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">所以我们必须有一个高可用方案来抵抗节点故障，当故障发生时可以自动进行从主切换，程序可以不用重启，运维可以继续睡大觉，仿佛什么事也没发生一样。Redis 官方提供了这样一种方案 —— Redis Sentinel(哨兵)。</span></div><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p><div style="margin: 22px auto; text-align: center;"><div><img src="https://user-gold-cdn.xitu.io/2018/7/4/16464072b3430480?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" style="font-size: 11pt; color: rgb(51, 51, 51);"></img></div><div style="text-align: center; font-size: 12px; line-height: 1.6; color: rgb(144, 144, 144); margin-top: 2px;"></div></div><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">我们可以将 Redis Sentinel 集群看成是一个 ZooKeeper 集群，它是集群高可用的心脏，它一般是由 3～5 个节点组成，这样挂了个别节点集群还可以正常运转。</span></div><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">它负责持续监控主从节点的健康，当主节点挂掉时，自动选择一个最优的从节点切换为主节点。客户端来连接集群时，会首先连接 sentinel，通过 sentinel 来查询主节点的地址，然后再去连接主节点进行数据交互。当主节点发生故障时，客户端会重新向 sentinel 要地址，sentinel 会将最新的主节点地址告诉客户端。如此应用程序将无需重启即可自动完成节点切换。比如上图的主节点挂掉后，集群将可能自动调整为下图所示结构。</span></div><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p><div style="margin: 22px auto; text-align: center;"><div><img src="https://user-gold-cdn.xitu.io/2018/7/4/164640d92239dacf?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" style="font-size: 11pt; color: rgb(51, 51, 51);"></img></div><div style="text-align: center; font-size: 12px; line-height: 1.6; color: rgb(144, 144, 144); margin-top: 2px;"></div></div><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">从这张图中我们能看到主节点挂掉了，原先的主从复制也断开了，客户端和损坏的主节点也断开了。从节点被提升为新的主节点，其它从节点开始和新的主节点建立复制关系。客户端通过新的主节点继续进行交互。Sentinel 会持续监控已经挂掉了主节点，待它恢复后，集群会调整为下面这张图。</span></div><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p><div style="margin: 22px auto; text-align: center;"><div><img src="https://user-gold-cdn.xitu.io/2018/7/4/1646410c0581795a?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" style="font-size: 11pt; color: rgb(51, 51, 51);"></img></div><div style="text-align: center; font-size: 12px; line-height: 1.6; color: rgb(144, 144, 144); margin-top: 2px;"></div></div><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">此时原先挂掉的主节点现在变成了从节点，从新的主节点那里建立复制关系。</span></div><h2 style="margin-top: 35px; margin-bottom: 10px; padding-bottom: 12px; font-size: 24px; border-bottom: 1px solid rgb(236, 236, 236);"><span style="font-size: 24px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.5;">消息丢失</span></h2><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">Redis 主从采用异步复制，意味着当主节点挂掉时，从节点可能没有收到全部的同步消息，这部分未同步的消息就丢失了。如果主从延迟特别大，那么丢失的数据就可能会特别多。Sentinel 无法保证消息完全不丢失，但是也尽可能保证消息少丢失。它有两个选项可以限制主从延迟过大。</span></div><div style="font-size: 1em; overflow: auto; position: relative;"><div lang="bash" style="border-radius: 2px; word-break: normal; font-size: 11px; overflow-x: auto; margin: 0px; background: rgb(248, 248, 248); padding: 18px 15px 12px;"><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">min-slaves-to-write 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">min-slaves-max-lag 10</span></div></div></div><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">第一个参数表示主节点必须至少有一个从节点在进行正常复制，否则就停止对外写服务，丧失可用性。</span></div><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">何为正常复制，何为异常复制？这个就是由第二个参数控制的，它的单位是秒，表示如果 10s 没有收到从节点的反馈，就意味着从节点同步不正常，要么网络断开了，要么一直没有给反馈。</span></div><h2 style="margin-top: 35px; margin-bottom: 10px; padding-bottom: 12px; font-size: 24px; border-bottom: 1px solid rgb(236, 236, 236);"><span style="font-size: 24px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.5;">Sentinel 基本使用</span></h2><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">接下来我们看看客户端如何使用 sentinel，标准的流程应该是客户端可以通过 sentinel 发现主从节点的地址，然后在通过这些地址建立相应的连接来进行数据存取操作。我们来看看 Python 客户端是如何做的。</span></div><div style="font-size: 1em; overflow: auto; position: relative;"><div lang="bash" style="border-radius: 2px; word-break: normal; font-size: 11px; overflow-x: auto; margin: 0px; background: rgb(248, 248, 248); padding: 18px 15px 12px;"><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">&gt;&gt;&gt; from redis.sentinel import Sentinel</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">&gt;&gt;&gt; sentinel = Sentinel([(</span><span style="font-size: 11px; color: rgb(221, 17, 68); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">'localhost'</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">, 26379)], socket_timeout=0.1)</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">&gt;&gt;&gt; sentinel.discover_master(</span><span style="font-size: 11px; color: rgb(221, 17, 68); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">'mymaster'</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">)</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">(</span><span style="font-size: 11px; color: rgb(221, 17, 68); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">'127.0.0.1'</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">, 6379)</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">&gt;&gt;&gt; sentinel.discover_slaves(</span><span style="font-size: 11px; color: rgb(221, 17, 68); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">'mymaster'</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">)</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">[(</span><span style="font-size: 11px; color: rgb(221, 17, 68); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">'127.0.0.1'</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">, 6380)]</span></div></div></div><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">sentinel 的默认端口是 26379，不同于 Redis 的默认端口 6379，通过 sentinel 对象的 discover_xxx 方法可以发现主从地址，主地址只有一个，从地址可以有多个。</span></div><div style="font-size: 1em; overflow: auto; position: relative;"><div lang="bash" style="border-radius: 2px; word-break: normal; font-size: 11px; overflow-x: auto; margin: 0px; background: rgb(248, 248, 248); padding: 18px 15px 12px;"><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">&gt;&gt;&gt; master = sentinel.master_for(</span><span style="font-size: 11px; color: rgb(221, 17, 68); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">'mymaster'</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">, socket_timeout=0.1)</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">&gt;&gt;&gt; slave = sentinel.slave_for(</span><span style="font-size: 11px; color: rgb(221, 17, 68); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">'mymaster'</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">, socket_timeout=0.1)</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">&gt;&gt;&gt; master.set(</span><span style="font-size: 11px; color: rgb(221, 17, 68); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">'foo'</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">,</span> <span style="font-size: 11px; color: rgb(221, 17, 68); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">'bar'</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">)</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">&gt;&gt;&gt; slave.get(</span><span style="font-size: 11px; color: rgb(221, 17, 68); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">'foo'</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">)</span></div><div><span style="font-size: 11px; color: rgb(221, 17, 68); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">'bar'</span></div></div></div><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">通过 xxx_for 方法可以从连接池中拿出一个连接来使用，因为从地址有多个，redis 客户端对从地址采用轮询方案，也就是 RoundRobin 轮着来。</span></div><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">有个问题是，但 sentinel 进行主从切换时，客户端如何知道地址变更了 ? 通过分析源码，我发现 redis-py 在建立连接的时候进行了主库地址变更判断。</span></div><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">连接池建立新连接时，会去查询主库地址，然后跟内存中的主库地址进行比对，如果变更了，就断开所有连接，重新使用新地址建立新连接。如果是旧的主库挂掉了，那么所有正在使用的连接都会被关闭，然后在重连时就会用上新地址。</span></div><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">但是这样还不够，如果是 sentinel 主动进行主从切换，主库并没有挂掉，而之前的主库连接已经建立了在使用了，没有新连接需要建立，那这个连接是不是一致切换不了？</span></div><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">继续深入研究源码，我发现 redis-py 在另外一个点也做了控制。那就是在处理命令的时候捕获了一个特殊的异常</span><span style="color: rgb(255, 80, 44); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75; background-color: rgb(255, 245, 245); border-radius: 2px; overflow-x: auto; padding: 0.065em 0.4em; word-break: break-word;">ReadOnlyError</span><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">，在这个异常里将所有的旧连接全部关闭了，后续指令就会进行重连。</span></div><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">主从切换后，之前的主库被降级到从库，所有的修改性的指令都会抛出</span><span style="color: rgb(255, 80, 44); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75; background-color: rgb(255, 245, 245); border-radius: 2px; overflow-x: auto; padding: 0.065em 0.4em; word-break: break-word;">ReadonlyError</span><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">。如果没有修改性指令，虽然连接不会得到切换，但是数据不会被破坏，所以即使不切换也没关系。</span></div><h2 style="margin-top: 35px; margin-bottom: 10px; padding-bottom: 12px; font-size: 24px; border-bottom: 1px solid rgb(236, 236, 236);"><span style="font-size: 24px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.5;">作业</span></h2><ol style="padding-left:28px;"><li style="margin-bottom:0px;list-style:inherit;padding-left:6px;"><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">尝试自己搭建一套 redis-sentinel 集群；</span></div></li><li style="margin-bottom:0px;list-style:inherit;padding-left:6px;"><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">使用 Python 或者 Java 的客户端对集群进行一些常规操作；</span></div></li><li style="margin-bottom:0px;list-style:inherit;padding-left:6px;"><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">试试主从切换，主动切换和被动切换都试一试，看看客户端能否正常切换连接；</span></div></li></ol></div><div style="padding-top: 30px;"><div style="margin: 1.3rem 0px; text-align: center; font-size: 16px;"><span style="font-size: 16px; color: rgb(144, 144, 144); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 500;">留言</span></div><div style="padding-bottom:12px;"><div style="position:relative;padding:1.3rem 1.3rem 1.3rem 6rem;background-color:rgb(248, 249, 250);border:1px solid rgb(241, 241, 241);border-radius:4px;"></div></div><ul style="padding:0px;margin:0px;"><li style="list-style:none;position:relative;padding-top:18px;padding-bottom:18px;"><div style="position:relative;overflow:hidden;"><div><a href="https://juejin.im/user/5b23d95a51882574dd4acb5f" style="background-color: transparent; cursor: pointer;" target="_blank"></a></div><div style="margin:0.5rem 0px 0px 3.5rem;"><div style="display:flex;-webkit-box-align:baseline;align-items:baseline;flex-wrap:wrap;"><div><a href="https://juejin.im/user/5b23d95a51882574dd4acb5f" style="background-color: transparent; cursor: pointer; font-size: 14.4px; margin-right: 7.2px; font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; color: rgb(51, 51, 51); font-weight: 600; text-decoration: none;" target="_blank">蒋海博</a></div><div style="font-size:12px;color:rgb(144, 144, 144);max-width:220px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;"></div></div><div style="margin: 0.3rem 0px 0.5rem; font-size: 14.4px;"><span style="margin-right: 0.5em; white-space: pre-wrap; font-size: 14.4px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; line-height: 1.7;">redis为啥不多弄几个主节点，这样用ngnix做负载均衡是不是一样的实现sentinel的功能。我是redis小白，不知道这样问对不对</span></div><div style="display: flex; -webkit-box-align: baseline; align-items: baseline;"><div><span style="cursor: pointer; position: relative; margin-right: 15px; font-size: 20px; height: 30px; user-select: none;"><span style="font-size: 13px; color: rgb(144, 144, 144); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif;">收起评论</span></span></div><div style="position:absolute;top:100%;left:0px;width:100%;"></div><span style="font-size: 12px; color: rgb(144, 144, 144); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif;">9天前</span></div><div style="margin-top:9px;border:1px solid rgb(234, 234, 234);border-radius:3px;"><div style="padding:16px;"><div><ul style="padding:0px;margin:0px;padding-bottom:15px;"><li style="list-style:none;padding-bottom:15px;"><div style="overflow:hidden;"><div style="display: flex; flex-wrap: wrap; -webkit-box-pack: start; justify-content: flex-start; font-size: 13px;"><div><span style="margin-right: 10px;"><a href="https://juejin.im/user/5a9c4a13f265da23826d733a" style="background-color: transparent; cursor: pointer; font-size: 15px; font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; line-height: 20px; color: rgb(51, 51, 51); text-decoration: none;" target="_blank">老錢</a></span></div><div><span style="font-size: 13px; color: rgba(43, 68, 116, 0.5); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; line-height: 20px;">资深洞主 @ 公众号【码洞】</span></div></div><div style="margin-top:5px;font-size:14px;white-space:pre-wrap;"><span style="margin-right: 0.5em; font-size: 14px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif;">往后看有方案</span></div><div style="padding-top: 5px;"><span style="font-size: 12px; color: rgb(144, 144, 144); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif;">5天前</span><span style="font-size: 12px; font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; background-color: transparent; color: rgb(144, 144, 144); text-decoration: none; cursor: pointer; margin-left: 16px; visibility: hidden;">回复</span></div></div></li></ul></div></div></div></div></div></li></ul></div></div></div></div></div></div><div><br/></div></span>
</div></body></html> 