<html>
<head>
  <title>Redis 深度历险：核心原理与应用实践 - 老錢 - 掘金小册</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307474 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="4195"/>
<h1>Redis 深度历险：核心原理与应用实践 - 老錢 - 掘金小册</h1>

<div>
<span><div style="text-size-adjust: 100%; font-size: 12px; word-break: break-word; text-rendering: optimizeLegibility; background-color: rgb(244, 245, 245);"><div style="overflow:hidden;"><div style="transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);"><div style="box-sizing:border-box;background-color:rgb(230, 231, 233);"><div style="box-shadow:rgba(0, 0, 0, 0.15) 1px 1px 8px;background-color:rgb(255, 255, 255);border-radius:2px;box-sizing:border-box;"><div style="word-break: break-word; font-size: 15px;"><h1 style="font-size: 30px; margin: 35px 0px 5px; padding-bottom: 5px;"><span style="font-size: 16px; display: inline-block; min-width: 100%; position: relative;"><span style="font-size: 30px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.5;">应用 3：节衣缩食 —— 位图</span></span></h1><div style="margin-bottom: 22px; margin-top: 25px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">在我们平时开发过程中，会有一些 bool 型数据需要存取，比如用户一年的签到记录，签了是 1，没签是 0，要记录 365 天。如果使用普通的 key/value，每个用户要记录 365 个，当用户上亿的时候，需要的存储空间是惊人的。</span></div><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">为了解决这个问题，Redis 提供了位图数据结构，这样每天的签到记录只占据一个位，365 天就是 365 个位，46 个字节 (一个稍长一点的字符串) 就可以完全容纳下，这就大大节约了存储空间。</span></div><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p><div style="margin: 22px auto; text-align: center;"><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;"><img src="Redis 深度历险：核心原理与应用实践 - 老錢 - 掘金小册 [5]_files/1645926f4520d0ce" type="image/gif" data-filename="1645926f4520d0ce" style="border-style:none;max-height:none;visibility:visible;background-color:transparent;background-position:50% center;background-repeat:no-repeat;background-image:none;max-width:100%;margin:0px;cursor:zoom-in;" width="512"/></span></div><div style="text-align: center; font-size: 12px; line-height: 1.6; color: rgb(144, 144, 144); margin-top: 2px;"></div></div><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">位图不是特殊的数据结构，它的内容其实就是普通的字符串，也就是 byte 数组。我们可以使用普通的 get/set 直接获取和设置整个位图的内容，也可以使用位图操作 getbit/setbit 等将 byte 数组看成「位数组」来处理。</span></div><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">以老钱的经验，在面试中有 Redis 位图使用经验的同学很少，如果你对 Redis 的位图有所了解，它将会是你的面试加分项。</span></div><h2 style="margin-top: 35px; margin-bottom: 10px; padding-bottom: 12px; font-size: 24px; border-bottom: 1px solid rgb(236, 236, 236);"><span style="font-size: 24px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.5;">基本使用</span></h2><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">Redis 的位数组是自动扩展，如果设置了某个偏移位置超出了现有的内容范围，就会自动将位数组进行零扩充。</span></div><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">接下来我们使用位操作将字符串设置为 hello (不是直接使用 set 指令)，首先我们需要得到 hello 的 ASCII 码，用 Python 命令行可以很方便地得到每个字符的 ASCII 码的二进制值。</span></div><div style="font-size: 1em; overflow: auto; position: relative;"><div lang="bash" style="border-radius: 2px; word-break: normal; font-size: 11px; overflow-x: auto; margin: 0px; background: rgb(248, 248, 248); padding: 18px 15px 12px;"><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">&gt;&gt;&gt; bin(ord(</span><span style="font-size: 11px; color: rgb(221, 17, 68); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">'h'</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">))</span></div><div><span style="font-size: 11px; color: rgb(221, 17, 68); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">'0b1101000'</span> <span style="font-size: 11px; color: rgb(153, 153, 136); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;"># 高位 -&gt; 低位</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">&gt;&gt;&gt; bin(ord(</span><span style="font-size: 11px; color: rgb(221, 17, 68); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">'e'</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">))</span></div><div><span style="font-size: 11px; color: rgb(221, 17, 68); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">'0b1100101'</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">&gt;&gt;&gt; bin(ord(</span><span style="font-size: 11px; color: rgb(221, 17, 68); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">'l'</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">))</span></div><div><span style="font-size: 11px; color: rgb(221, 17, 68); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">'0b1101100'</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">&gt;&gt;&gt; bin(ord(</span><span style="font-size: 11px; color: rgb(221, 17, 68); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">'l'</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">))</span></div><div><span style="font-size: 11px; color: rgb(221, 17, 68); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">'0b1101100'</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">&gt;&gt;&gt; bin(ord(</span><span style="font-size: 11px; color: rgb(221, 17, 68); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">'o'</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">))</span></div><div><span style="font-size: 11px; color: rgb(221, 17, 68); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">'0b1101111'</span></div></div></div><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p><div style="margin: 22px auto; text-align: center;"><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;"><img src="Redis 深度历险：核心原理与应用实践 - 老錢 - 掘金小册 [5]_files/16459860644097de" type="image/gif" data-filename="16459860644097de" style="border-style:none;max-height:none;visibility:visible;background-color:transparent;background-position:50% center;background-repeat:no-repeat;background-image:none;max-width:100%;margin:0px;cursor:zoom-in;" width="512"/></span></div><div style="text-align: center; font-size: 12px; line-height: 1.6; color: rgb(144, 144, 144); margin-top: 2px;"></div></div><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">接下来我们使用 redis-cli 设置第一个字符，也就是位数组的前 8 位，我们只需要设置值为 1 的位，如上图所示，h 字符只有 1/2/4 位需要设置，e 字符只有 9/10/13/15 位需要设置。值得注意的是位数组的顺序和字符的位顺序是相反的。</span></div><div style="font-size: 1em; overflow: auto; position: relative;"><div lang="bash" style="border-radius: 2px; word-break: normal; font-size: 11px; overflow-x: auto; margin: 0px; background: rgb(248, 248, 248); padding: 18px 15px 12px;"><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; setbit s 1 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">(</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 0</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; setbit s 2 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">(</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 0</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; setbit s 4 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">(</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 0</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; setbit s 9 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">(</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 0</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; setbit s 10 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">(</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 0</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; setbit s 13 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">(</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 0</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; setbit s 15 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">(</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 0</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; get s</span></div><div><span style="font-size: 11px; color: rgb(221, 17, 68); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">&quot;he&quot;</span></div></div></div><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">上面这个例子可以理解为「零存整取」，同样我们还也可以「零存零取」，「整存零取」。「零存」就是使用 setbit 对位值进行逐个设置，「整存」就是使用字符串一次性填充所有位数组，覆盖掉旧值。</span></div><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 700; line-height: 1.75;">零存零取</span></div><div style="font-size: 1em; overflow: auto; position: relative;"><div lang="bash" style="border-radius: 2px; word-break: normal; font-size: 11px; overflow-x: auto; margin: 0px; background: rgb(248, 248, 248); padding: 18px 15px 12px;"><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; setbit w 1 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">(</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 0</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; setbit w 2 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">(</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 0</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; setbit w 4 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">(</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 0</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; getbit w 1</span> <span style="font-size: 11px; color: rgb(153, 153, 136); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;"># 获取某个具体位置的值 0/1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">(</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; getbit w 2</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">(</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; getbit w 4</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">(</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; getbit w 5</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">(</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 0</span></div></div></div><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 700; line-height: 1.75;">整存零取</span></div><div style="font-size: 1em; overflow: auto; position: relative;"><div lang="bash" style="border-radius: 2px; word-break: normal; font-size: 11px; overflow-x: auto; margin: 0px; background: rgb(248, 248, 248); padding: 18px 15px 12px;"><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt;</span> <span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">set</span> <span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">w h</span> <span style="font-size: 11px; color: rgb(153, 153, 136); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;"># 整存</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">(</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 0</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; getbit w 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">(</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; getbit w 2</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">(</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; getbit w 4</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">(</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; getbit w 5</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">(</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 0</span></div></div></div><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">如果对应位的字节是不可打印字符，redis-cli 会显示该字符的 16 进制形式。</span></div><div style="font-size: 1em; overflow: auto; position: relative;"><div lang="bash" style="border-radius: 2px; word-break: normal; font-size: 11px; overflow-x: auto; margin: 0px; background: rgb(248, 248, 248); padding: 18px 15px 12px;"><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; setbit x 0 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">(</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 0</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; setbit x 1 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">(</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 0</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; get x</span></div><div><span style="font-size: 11px; color: rgb(221, 17, 68); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">&quot;\xc0&quot;</span></div></div></div><h2 style="margin-top: 35px; margin-bottom: 10px; padding-bottom: 12px; font-size: 24px; border-bottom: 1px solid rgb(236, 236, 236);"><span style="font-size: 24px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.5;">统计和查找</span></h2><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">Redis 提供了位图统计指令 bitcount 和位图查找指令 bitpos，bitcount 用来统计指定位置范围内 1 的个数，bitpos 用来查找指定范围内出现的第一个 0 或 1。</span></div><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">比如我们可以通过 bitcount 统计用户一共签到了多少天，通过 bitpos 指令查找用户从哪一天开始第一次签到。如果指定了范围参数</span><span style="color: rgb(255, 80, 44); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75; background-color: rgb(255, 245, 245); border-radius: 2px; overflow-x: auto; padding: 0.065em 0.4em; word-break: break-word;">[start, end]</span><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">，就可以统计在某个时间范围内用户签到了多少天，用户自某天以后的哪天开始签到。</span></div><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">遗憾的是， start 和 end 参数是字节索引，也就是说指定的位范围必须是 8 的倍数，而不能任意指定。这很奇怪，我表示不是很能理解 Antirez 为什么要这样设计。因为这个设计，我们无法直接计算某个月内用户签到了多少天，而必须要将这个月所覆盖的字节内容全部取出来 (getrange 可以取出字符串的子串) 然后在内存里进行统计，这个非常繁琐。</span></div><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">接下来我们简单试用一下 bitcount 指令和 bitpos 指令:</span></div><div style="font-size: 1em; overflow: auto; position: relative;"><div lang="bash" style="border-radius: 2px; word-break: normal; font-size: 11px; overflow-x: auto; margin: 0px; background: rgb(248, 248, 248); padding: 18px 15px 12px;"><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt;</span> <span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">set</span> <span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">w hello</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">OK</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; bitcount w</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">(</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 21</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; bitcount w 0 0</span> <span style="font-size: 11px; color: rgb(153, 153, 136); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;"># 第一个字符中 1 的位数</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">(</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 3</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; bitcount w 0 1</span> <span style="font-size: 11px; color: rgb(153, 153, 136); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;"># 前两个字符中 1 的位数</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">(</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 7</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; bitpos w 0</span> <span style="font-size: 11px; color: rgb(153, 153, 136); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;"># 第一个 0 位</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">(</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 0</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; bitpos w 1</span> <span style="font-size: 11px; color: rgb(153, 153, 136); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;"># 第一个 1 位</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">(</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; bitpos w 1 1 1</span> <span style="font-size: 11px; color: rgb(153, 153, 136); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;"># 从第二个字符算起，第一个 1 位</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">(</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 9</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; bitpos w 1 2 2</span> <span style="font-size: 11px; color: rgb(153, 153, 136); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;"># 从第三个字符算起，第一个 1 位</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">(</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 17</span></div></div></div><h2 style="margin-top: 35px; margin-bottom: 10px; padding-bottom: 12px; font-size: 24px; border-bottom: 1px solid rgb(236, 236, 236);"><span style="font-size: 24px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.5;">魔术指令 bitfield</span></h2><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">前文我们设置 (setbit) 和获取 (getbit) 指定位的值都是单个位的，如果要一次操作多个位，就必须使用管道来处理。</span></div><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">不过 Redis 的 3.2 版本以后新增了一个功能强大的指令，有了这条指令，不用管道也可以一次进行多个位的操作。</span></div><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">bitfield 有三个子指令，分别是 get/set/incrby，它们都可以对指定位片段进行读写，但是最多只能处理 64 个连续的位，如果超过 64 位，就得使用多个子指令，bitfield 可以一次执行多个子指令。</span></div><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p><div style="margin: 22px auto; text-align: center;"><div><img src="https://user-gold-cdn.xitu.io/2018/7/2/1645987653a2b337?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" style="font-size: 11pt; color: rgb(51, 51, 51);"></img></div><div style="text-align: center; font-size: 12px; line-height: 1.6; color: rgb(144, 144, 144); margin-top: 2px;"></div></div><p style="line-height:inherit;margin-top:22px;margin-bottom:22px;"></p><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">接下来我们对照着上面的图看个简单的例子:</span></div><div style="font-size: 1em; overflow: auto; position: relative;"><div lang="bash" style="border-radius: 2px; word-break: normal; font-size: 11px; overflow-x: auto; margin: 0px; background: rgb(248, 248, 248); padding: 18px 15px 12px;"><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt;</span> <span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">set</span> <span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">w hello</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">OK</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; bitfield w get u4 0</span> <span style="font-size: 11px; color: rgb(153, 153, 136); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;"># 从第一个位开始取 4 个位，结果是无符号数 (u)</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">(</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 6</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; bitfield w get u3 2</span> <span style="font-size: 11px; color: rgb(153, 153, 136); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;"># 从第三个位开始取 3 个位，结果是无符号数 (u)</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">(</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 5</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; bitfield w get i4 0</span> <span style="font-size: 11px; color: rgb(153, 153, 136); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;"># 从第一个位开始取 4 个位，结果是有符号数 (i)</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">1) (</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 6</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; bitfield w get i3 2</span> <span style="font-size: 11px; color: rgb(153, 153, 136); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;"># 从第三个位开始取 3 个位，结果是有符号数 (i)</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">1) (</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) -3</span></div></div></div><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">所谓有符号数是指获取的位数组中第一个位是符号位，剩下的才是值。如果第一位是 1，那就是负数。无符号数表示非负数，没有符号位，获取的位数组全部都是值。有符号数最多可以获取 64 位，无符号数只能获取 63 位 (因为 Redis 协议中的 integer 是有符号数，最大 64 位，不能传递 64 位无符号值)。如果超出位数限制，Redis 就会告诉你参数错误。</span></div><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">接下来我们一次执行多个子指令:</span></div><div style="font-size: 1em; overflow: auto; position: relative;"><div lang="bash" style="border-radius: 2px; word-break: normal; font-size: 11px; overflow-x: auto; margin: 0px; background: rgb(248, 248, 248); padding: 18px 15px 12px;"><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; bitfield w get u4 0 get u3 2 get i4 0 get i3 2</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">1) (</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 6</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">2) (</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 5</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">3) (</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 6</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">4) (</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) -3</span></div></div></div><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">wow，很魔法有没有！</span></div><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">然后我们使用 set 子指令将第二个字符 e 改成 a，a 的 ASCII 码是 97。</span></div><div style="font-size: 1em; overflow: auto; position: relative;"><div lang="bash" style="border-radius: 2px; word-break: normal; font-size: 11px; overflow-x: auto; margin: 0px; background: rgb(248, 248, 248); padding: 18px 15px 12px;"><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; bitfield w</span> <span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">set</span> <span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">u8 8 97</span> <span style="font-size: 11px; color: rgb(153, 153, 136); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;"># 从第 8 个位开始，将接下来的 8 个位用无符号数 97 替换</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">1) (</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 101</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; get w</span></div><div><span style="font-size: 11px; color: rgb(221, 17, 68); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">&quot;hallo&quot;</span></div></div></div><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">再看第三个子指令 incrby，它用来对指定范围的位进行自增操作。既然提到自增，就有可能出现溢出。如果增加了正数，会出现上溢，如果增加的是负数，就会出现下溢出。Redis 默认的处理是折返。如果出现了溢出，就将溢出的符号位丢掉。如果是 8 位无符号数 255，加 1 后就会溢出，会全部变零。如果是 8 位有符号数 127，加 1 后就会溢出变成 -128。</span></div><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">接下来我们实践一下这个子指令 incrby :</span></div><div style="font-size: 1em; overflow: auto; position: relative;"><div lang="bash" style="border-radius: 2px; word-break: normal; font-size: 11px; overflow-x: auto; margin: 0px; background: rgb(248, 248, 248); padding: 18px 15px 12px;"><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt;</span> <span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">set</span> <span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">w hello</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">OK</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; bitfield w incrby u4 2 1</span> <span style="font-size: 11px; color: rgb(153, 153, 136); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;"># 从第三个位开始，对接下来的 4 位无符号数 +1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">1) (</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 11</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; bitfield w incrby u4 2 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">1) (</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 12</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; bitfield w incrby u4 2 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">1) (</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 13</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; bitfield w incrby u4 2 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">1) (</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 14</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; bitfield w incrby u4 2 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">1) (</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 15</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; bitfield w incrby u4 2 1</span> <span style="font-size: 11px; color: rgb(153, 153, 136); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;"># 溢出折返了</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">1) (</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 0</span></div></div></div><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">bitfield 指令提供了溢出策略子指令 overflow，用户可以选择溢出行为，默认是折返 (wrap)，还可以选择失败 (fail) 报错不执行，以及饱和截断 (sat)，超过了范围就停留在最大最小值。overflow 指令只影响接下来的第一条指令，这条指令执行完后溢出策略会变成默认值折返 (wrap)。</span></div><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">接下来我们分别试试这两个策略的行为</span></div><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 700; line-height: 1.75;">饱和截断 SAT</span></div><div style="font-size: 1em; overflow: auto; position: relative;"><div lang="bash" style="border-radius: 2px; word-break: normal; font-size: 11px; overflow-x: auto; margin: 0px; background: rgb(248, 248, 248); padding: 18px 15px 12px;"><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt;</span> <span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">set</span> <span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">w hello</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">OK</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; bitfield w overflow sat incrby u4 2 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">1) (</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 11</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; bitfield w overflow sat incrby u4 2 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">1) (</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 12</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; bitfield w overflow sat incrby u4 2 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">1) (</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 13</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; bitfield w overflow sat incrby u4 2 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">1) (</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 14</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; bitfield w overflow sat incrby u4 2 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">1) (</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 15</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; bitfield w overflow sat incrby u4 2 1</span> <span style="font-size: 11px; color: rgb(153, 153, 136); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;"># 保持最大值</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">1) (</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 15</span></div></div></div><div style="margin-top: 22px; margin-bottom: 22px;"><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 700; line-height: 1.75;">失败不执行 FAIL</span></div><div style="font-size: 1em; overflow: auto; position: relative;"><div lang="bash" style="border-radius: 2px; word-break: normal; font-size: 11px; overflow-x: auto; margin: 0px; background: rgb(248, 248, 248); padding: 18px 15px 12px;"><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt;</span> <span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">set</span> <span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">w hello</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">OK</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; bitfield w overflow fail incrby u4 2 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">1) (</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 11</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; bitfield w overflow fail incrby u4 2 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">1) (</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 12</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; bitfield w overflow fail incrby u4 2 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">1) (</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 13</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; bitfield w overflow fail incrby u4 2 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">1) (</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 14</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; bitfield w overflow fail incrby u4 2 1</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">1) (</span><span style="font-size: 11px; color: rgb(0, 134, 179); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">integer</span><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">) 15</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">127.0.0.1:6379&gt; bitfield w overflow fail incrby u4 2 1</span> <span style="font-size: 11px; color: rgb(153, 153, 136); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;"># 不执行</span></div><div><span style="font-size: 11px; color: rgb(51, 51, 51); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-weight: 400; line-height: 1.75;">1) (nil)</span></div></div></div><h2 style="margin-top: 35px; margin-bottom: 10px; padding-bottom: 12px; font-size: 24px; border-bottom: 1px solid rgb(236, 236, 236);"><span style="font-size: 24px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.5;">思考 &amp; 作业</span></h2><ol style="padding-left:28px;"><li style="margin-bottom:0px;list-style:inherit;padding-left:6px;"><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">文中我们使用位操作设置了 he 两个字符，请读者将完整的 hello 单词中 5 个字符都使用位操作设置一下。</span></div></li><li style="margin-bottom:0px;list-style:inherit;padding-left:6px;"><div><span style="font-size: 15px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-weight: 400; line-height: 1.75;">bitfield 可以同时混合执行多个 set/get/incrby 子指令，请读者尝试完成。</span></div></li></ol></div></div></div></div></div></div><div><br/></div></span>
</div></body></html> 